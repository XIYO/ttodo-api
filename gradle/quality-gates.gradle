/**
 * í’ˆì§ˆ ê²Œì´íŠ¸ í†µí•© ì„¤ì •
 * IntelliJ IDEA Ultimate ë‚´ì¥ ê²€ì‚¬ ë„êµ¬ ì‚¬ìš©
 */

// ===== í’ˆì§ˆ ì²´í¬ í†µí•© íƒœìŠ¤í¬ (IntelliJ ê¸°ë°˜) =====
task qualityGate {
    group = 'verification'
    description = 'Run quality checks (Tests, Coverage) - Use IntelliJ inspections for code analysis'

    dependsOn 'test'
    dependsOn 'jacocoTestReport'

    doLast {
        println """
        ========================================
        í’ˆì§ˆ ê²€ì‚¬ ì™„ë£Œ! (IntelliJ ê¸°ë°˜)
        ========================================
        âœ… í…ŒìŠ¤íŠ¸: PASSED
        âœ… ì»¤ë²„ë¦¬ì§€: build/reports/jacoco/test/html/
        
        ğŸ“‹ IntelliJ IDEAì—ì„œ ì¶”ê°€ ê²€ì‚¬:
        - Code Inspection (Analyze â†’ Inspect Code)
        - All Inspections Profile í™œì„±í™”ë¨
        - Save Actions í”ŒëŸ¬ê·¸ì¸ í™œì„±í™”ë¨
        
        SonarCloud ë¶„ì„ ì‹¤í–‰:
        ./gradlew sonar -Dsonar.token=YOUR_TOKEN
        ========================================
        """
    }
}

// Google ìŠ¤íƒ€ì¼ë¡œ ì „í™˜
task switchToGoogleStyle {
    group = 'verification'
    description = 'Switch to Google Java Style'
    doLast {
        println "Switched to Google Java Style. Run with: ./gradlew build -PuseGoogleStyle"
    }
}

// ì—„ê²©í•œ í’ˆì§ˆ ê²€ì‚¬ (CI/CDìš©)
task strictQualityCheck {
    group = 'verification'
    description = 'Strict quality check for CI/CD'

    dependsOn qualityGate

    doLast {
        // ì»¤ë²„ë¦¬ì§€ ì²´í¬
        def coverageReport = file("build/reports/jacoco/test/jacocoTestReport.xml")
        if (coverageReport.exists()) {
            println "Coverage report generated"
        } else {
            throw new GradleException("Coverage report not found!")
        }
    }
}

// SonarCloudì™€ ë¡œì»¬ ê²€ì‚¬ ëª¨ë‘ ì‹¤í–‰
task fullQualityAnalysis {
    group = 'verification'
    description = 'Run local quality checks and SonarCloud analysis'

    dependsOn qualityGate
    finalizedBy 'sonar'
}