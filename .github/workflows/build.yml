name: Release Please Workflow
# ì›Œí¬í”Œë¡œìš°ì˜ ì´ë¦„ì…ë‹ˆë‹¤.

on:
  push:
    branches:
      - main
      # main ë¸Œëœì¹˜ì— í‘¸ì‹œë  ë•Œ ì›Œí¬í”Œë¡œìš°ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.

permissions:
  contents: write       # ë¦´ë¦¬ì¦ˆ íƒœê·¸ ìƒì„± ë° ì»¤ë°‹ í‘¸ì‹œì— í•„ìš”í•œ ê¶Œí•œì…ë‹ˆë‹¤.
  pull-requests: write    # ë¦´ë¦¬ì¦ˆ PR ìƒì„±(í•„ìš”ì‹œ)ì„ ìœ„í•œ ê¶Œí•œì…ë‹ˆë‹¤.

jobs:
  release:
    runs-on: ubuntu-latest
    outputs:
      release_created: ${{ steps.release.outputs.release_created }}
      release_version: ${{ steps.release.outputs.release_version }}
    # release jobì—ì„œëŠ” release-please ì•¡ì…˜ì„ ì‹¤í–‰í•˜ì—¬ ìƒˆ ë¦´ë¦¬ì¦ˆ ìƒì„± ì—¬ë¶€ì™€ ë²„ì „ì„ ì¶œë ¥ ë³€ìˆ˜ë¡œ ì €ì¥í•©ë‹ˆë‹¤.
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          # ì „ì²´ ì»¤ë°‹ íˆìŠ¤í† ë¦¬ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤. ê¸°ì¡´ íƒœê·¸ ë° ì»¤ë°‹ ì´ë ¥ì„ í™•ì¸í•˜ê¸° ìœ„í•´ í•„ìš”í•©ë‹ˆë‹¤.

      - name: Run Release Please
        id: release
        uses: googleapis/release-please-action@v4
        with:
          release-type: simple
          # ë‹¨ìˆœí•œ(release-type: simple) ì „ëµì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
          token: ${{ secrets.GITHUB_TOKEN }}
          # GitHub ì•¡ì…˜ì—ì„œ ì œê³µí•˜ëŠ” ê¸°ë³¸ í† í°ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
          skip-github-pull-request: true
          # ë¦´ë¦¬ì¦ˆ PR ëŒ€ì‹  íƒœê·¸ë¥¼ ë°”ë¡œ ìƒì„±í•©ë‹ˆë‹¤.

      - name: Display Release Outputs
        run: echo "New version is ${{ steps.release.outputs.release_version }}"
        # release-please ì•¡ì…˜ì˜ ì¶œë ¥ ê²°ê³¼(ìƒˆ ë²„ì „)ë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤.

      - name: Update version in gradle.properties
        if: steps.release.outputs.release_created == 'true'
        # ìƒˆ ë¦´ë¦¬ì¦ˆê°€ ìƒì„±ëœ ê²½ìš°ì—ë§Œ ì‹¤í–‰ë©ë‹ˆë‹¤.
        run: |
          # gradle.properties íŒŒì¼ì—ì„œ version ê°’ì„ ìƒˆë¡œìš´ ë²„ì „ìœ¼ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.
          sed -i 's/^version=.*/version=${{ steps.release.outputs.release_version }}/' gradle.properties
          # Git ì‚¬ìš©ì ì •ë³´ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          # ë³€ê²½ëœ gradle.properties íŒŒì¼ì„ ìŠ¤í…Œì´ì§€í•©ë‹ˆë‹¤.
          git add gradle.properties
          # ë²„ì „ ì—…ë°ì´íŠ¸ ì»¤ë°‹ì„ ìƒì„±í•©ë‹ˆë‹¤.
          git commit -m "ğŸ”– Bump version to ${{ steps.release.outputs.release_version }}"
          # main ë¸Œëœì¹˜ì— ë³€ê²½ì‚¬í•­ì„ í‘¸ì‹œí•©ë‹ˆë‹¤.
          git push origin main

  build:
    runs-on: ubuntu-latest
    needs: release
    if: needs.release.outputs.release_created == 'true'
    # ìƒˆ ë¦´ë¦¬ì¦ˆê°€ ìƒì„±ëœ ê²½ìš°ì—ë§Œ ë¹Œë“œ ì‘ì—…ì„ ì§„í–‰í•©ë‹ˆë‹¤.
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Set up JDK 21
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '21'
          cache: 'gradle'
          # Gradle ìºì‹œë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹Œë“œ ì†ë„ë¥¼ ë†’ì…ë‹ˆë‹¤.

      - name: Build Project
        run: ./gradlew build -x test
        # í…ŒìŠ¤íŠ¸ë¥¼ ì œì™¸í•˜ê³  í”„ë¡œì íŠ¸ë¥¼ ë¹Œë“œí•©ë‹ˆë‹¤.